---
---
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Garden Bed Plants â€” Compatibility Calculator</title>

  <style>
    /* --- PAGE SPECIFIC STYLES --- */
    /* Note: We keep the page logic here, but the Header CSS is loaded via the include */

    :root { --accent: #175226; --muted: #666; --bg: #ffffff; --alt-row: #f9f5f0; --border: #ddd; }
    
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      /* PADDING: 120px top to ensure the fixed header doesn't cover your title */
      padding: 120px 20px 20px 20px; 
      color: #222;
      background: #fbfbfb;
      min-height: 100vh;
      box-sizing: border-box;
    }

    .container { max-width: 1100px; margin: 0 auto; }
    h1 { color: var(--accent); margin: 0 0 18px; font-size: 28px; border-bottom: 2px solid var(--accent); padding-bottom: 8px; }
    .row-plant { display: flex; gap: 18px; margin: 18px 0; align-items: flex-start; flex-wrap: wrap; }
    .input-group { display: flex; flex-direction: column; flex: 1 1 240px; min-width: 200px; }
    label { font-weight: 600; color: var(--accent); margin-bottom: 6px; font-size: 14px; }
    select { padding: 8px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); font-size: 14px; }
    #compatibility { margin: 14px 0; padding: 10px 12px; border-left: 5px solid var(--accent); background: #eef7ef; color: var(--accent); font-weight: 700; border-radius: 6px; }

    /* Results Table Styles */
    #desktop-results { margin-top: 18px; overflow: auto; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); box-shadow: 0 6px 18px rgba(0,0,0,0.04); }
    #desktop-results table { width: 100%; border-collapse: separate; border-spacing: 0; table-layout: fixed; }
    #desktop-results th { position: sticky; top: 0; z-index: 5; background: var(--accent); color: #fff; text-align: left; padding: 12px 14px; font-weight: 700; border-right: 1px solid rgba(0,0,0,0.05); }
    #desktop-results td { padding: 12px 14px; border-bottom: 1px solid var(--border); border-right: 1px solid rgba(0,0,0,0.03); vertical-align: top; word-wrap: break-word; }
    #desktop-results tbody tr:nth-child(even) td { background: var(--alt-row); }
    
    #mobile-results .plant-table { width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid var(--border); border-radius: 6px; overflow: hidden; background: var(--bg); }
    #mobile-results .plant-table th, #mobile-results .plant-table td { border: 1px solid var(--border); padding: 10px; text-align: left; }
    #mobile-results .plant-table th { background: var(--accent); color: #fff; font-weight: 700; }
    #mobile-results .plant-table tbody tr:nth-child(even) td { background: var(--alt-row); }

    @media (max-width: 768px) { .row-plant { flex-direction: column; } #desktop-results { display: none; } }
    @media (min-width: 769px) { #mobile-results { display: none; } }
    .plant-pair { margin: 6px 0; font-size: 16px; color: var(--accent); }
    .compat-text { font-weight: 800; margin-left: 8px; color: #175226; }
    .small-muted { color: var(--muted); font-size: 13px; margin-top: 6px; }
  </style>
</head>
<body>

  {% include_relative header.html %}

  <div class="container">
    <h1>Garden Bed Plants</h1>

    <div class="row-plant">
      <div class="input-group"><label for="dropdown1">Choose the first plant:</label><select id="dropdown1"><option value="">--Select--</option></select></div>
      <div class="input-group"><label for="dropdown2">Choose the second plant:</label><select id="dropdown2"><option value="">--Select--</option></select></div>
    </div>

    <div class="row-plant">
      <div class="input-group"><label for="dropdown3">Choose the third plant:</label><select id="dropdown3"><option value="">--Select--</option></select></div>
      <div class="input-group"><label for="dropdown4">Choose the fourth plant:</label><select id="dropdown4"><option value="">--Select--</option></select></div>
    </div>

    <div id="compatibility">Select plants to check compatibility.</div>
    <div id="desktop-results" aria-live="polite"></div>
    <div id="mobile-results" aria-live="polite"></div>
    <p class="small-muted">If lists don't populate check the CSV URL and that the sheet is published to the web.</p>
  </div>

  <script>
    const originalSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR6JO3Q9MKs9IRYy1E7bdVNb7pQMdt1VUwoeNioj3Y9Y9Rie26swdYemV6ym1eqHc3KhHYwRVD2Xv_i/pub?gid=766419629&single=true&output=csv";
    const proxyUrl = "https://corsproxy.io/?"; 
    const sheetUrl = proxyUrl + encodeURIComponent(originalSheetUrl);

    const DROPDOWN_IDS = ["dropdown1","dropdown2","dropdown3","dropdown4"];
    let rows = [];            
    let headerRow = [];       
    let columnNames = [];     
    let companionColumnIndex = -1; 

    function parseCSV(text) {
      const result = [];
      let row = [];
      let token = '';
      let inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i + 1];
        if (ch === '"') { inQuotes && next === '"' ? (token += '"', i++) : (inQuotes = !inQuotes); } 
        else if (ch === ',' && !inQuotes) { row.push(token); token = ''; } 
        else if ((ch === '\n' || ch === '\r') && !inQuotes) {
          if (ch === '\r' && next === '\n') { i++; }
          row.push(token); token = ''; result.push(row); row = [];
        } else { token += ch; }
      }
      if (token !== '' || row.length) { row.push(token); result.push(row); }
      return result;
    }

    function populateDropdowns() {
      const nameIndex = headerRow.length > 1 ? 1 : 0;
      const names = rows.slice(1).map(r => (r[nameIndex] || '').trim()).filter(n => n && n.toLowerCase() !== 'common name' && n.toLowerCase() !== 'coming soon');
      const unique = Array.from(new Set(names)).sort((a,b)=>a.localeCompare(b));
      DROPDOWN_IDS.forEach(id => {
        const dd = document.getElementById(id);
        const current = dd.value || '';
        dd.innerHTML = '<option value="">--Select--</option>';
        unique.forEach(name => {
          const opt = document.createElement('option');
          opt.value = name; opt.textContent = name; dd.appendChild(opt);
        });
        if (current) dd.value = current;
        dd.addEventListener('change', updateResults);
      });
    }

    async function init() {
      const desktop = document.getElementById('desktop-results');
      const mobile = document.getElementById('mobile-results');
      const compat = document.getElementById('compatibility');
      try {
        compat.textContent = 'Loading plant data...';
        const res = await fetch(sheetUrl);
        if (!res.ok) throw new Error('Network response was not ok: ' + res.status);
        const text = await res.text();
        if (text.trim().toLowerCase().startsWith('<!doctype html')) throw new Error("Received HTML instead of CSV.");
        rows = parseCSV(text);
        if (!rows || rows.length < 2) throw new Error('No data found in sheet.');
        headerRow = rows[0].map(h => (h||'').toString().trim());
        columnNames = headerRow.slice(1, 73);
        companionColumnIndex = headerRow.findIndex(h => /companion/i.test(h)) > -1 ? headerRow.findIndex(h => /companion/i.test(h)) : 9;
        populateDropdowns();
        compat.textContent = 'Select plants to check compatibility.';
      } catch (err) {
        console.error(err);
        compat.textContent = 'Error loading plant data.';
        compat.style.color = 'crimson';
      }
    }

    function updateResults() {
      const selected = DROPDOWN_IDS.map(id => document.getElementById(id).value).filter(v => v);
      document.getElementById('compatibility').textContent = buildCompatibilityMessage(selected);
      document.getElementById('desktop-results').innerHTML = buildDesktopTable(selected);
      document.getElementById('mobile-results').innerHTML = buildMobileTables(selected);
    }

    function buildDesktopTable(selected) {
      if (!selected.length) return '';
      let html = '<table><thead><tr><th>Category</th>' + selected.map(p => `<th>${escapeHtml(p)}</th>`).join('') + '</tr></thead><tbody>';
      for (let i = 0; i < columnNames.length; i++) {
        const col = columnNames[i] || '';
        html += `<tr><td><strong>${escapeHtml(col)}</strong></td>`;
        selected.forEach(p => {
          const row = rows.find(r => (r[1]||'').trim() === p);
          let val = row ? (row[i+1] || '') : 'No Data';
          html += `<td>${escapeHtml(String(val))}</td>`;
        });
        html += '</tr>';
      }
      return html + '</tbody></table>';
    }

    function buildMobileTables(selected) {
      if (!selected.length) return '';
      let html = '';
      selected.forEach(p => {
        const row = rows.find(r => (r[1]||'').trim() === p);
        if (!row) return;
        html += `<table class="plant-table"><thead><tr><th colspan="2">${escapeHtml(p)}</th></tr></thead><tbody>`;
        for (let i = 0; i < columnNames.length; i++) {
            let val = row[i+1] || '';
            html += `<tr><td><strong>${escapeHtml(columnNames[i])}</strong></td><td>${escapeHtml(String(val))}</td></tr>`;
        }
        html += '</tbody></table>';
      });
      return html;
    }

    function buildCompatibilityMessage(selected) {
      if (selected.length < 2) return 'Select at least two plants to check compatibility.';
      return 'Compatibility check logic active (Results in console or implement full logic).';
    }

    function escapeHtml(str) { return (str || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>    

